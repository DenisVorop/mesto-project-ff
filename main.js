(()=>{"use strict";var e=function(e,t,n,r,o){var c=t.name,a=t.link,i=t._id,u=t.likes,l=e.content.querySelector(".card").cloneNode(!0),d=l.querySelector(".card__image"),s=l.querySelector(".card__title"),p=l.querySelector(".card__delete-button"),f=l.querySelector(".card__like-button"),m=l.querySelector(".card__like-counter");return l.setAttribute("data-card-id",i),d.src=a,d.alt="на изображении ".concat(c),s.textContent=c,m.textContent=u.length,p.addEventListener("click",(function(){return n({id:i})})),f.addEventListener("click",r),d.addEventListener("click",(function(){return o({name:c,link:a})})),l},t=function(e,t){e.querySelector(".card__like-counter").textContent=t},n=function(e,n){var r=e.target.closest(".card"),o=e.target;t(r,n),o.classList.toggle("card__like-button_is-active")},r=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");c(t)}},o=function(e){if(e.target.contains(e.currentTarget)||e.target.classList.contains("popup__close")){var t=document.querySelector(".popup_is-opened");c(t)}},c=function(e){var t;e.classList.remove("popup_is-opened"),null===(t=e.querySelector(".popup__form"))||void 0===t||t.reset(),e.removeEventListener("click",o),document.removeEventListener("keydown",r)},a=function(e){e.classList.add("popup_is-opened"),e.addEventListener("click",o),document.addEventListener("keydown",r)},i="PATCH",u="DELETE",l=function(e){return"/cards/".concat(e)},d=function(e){return"/cards/likes/".concat(e)},s={baseUrl:"https://nomoreparties.co/v1/cohort-magistr-2",headers:{authorization:"b44bee0a-d29f-428f-9afc-1ffe63840a0c","Content-Type":"application/json"}},p=function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))},f=function(e){var t=e.url,n=e.method,r=void 0===n?"GET":n,o=e.body;return fetch("".concat(s.baseUrl,"/").concat(t),{method:r,headers:s.headers,body:JSON.stringify(o)})},m=function(e){return f({url:d(e),method:"PUT"}).then(p)},_=function(e){return f({url:d(e),method:u}).then(p)},v=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("form__input_type_error"),n.classList.remove("form__input-error_active"),n.textContent=""},y=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("popup__button_disabled"),t.disabled=!1):(t.classList.add("popup__button_disabled"),t.disabled=!0)},h=function(e,t){var n=Array.from(e.querySelectorAll(".popup__input")),r=e.querySelector(".popup__button");n.forEach((function(e){e.setCustomValidity(""),v(t,e)})),y(n,r)};function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var S=document.getElementById("card-template"),g=document.querySelector(".places__list"),k=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__edit-button"),L=document.querySelector(".popup_type_new-card"),E=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_image"),A=document.querySelector(".popup_type_confirm_removing"),w=document.querySelector(".popup_type_new_avatar"),x=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),O=document.querySelector(".profile__image"),T=document.querySelector(".popup__image"),D=document.querySelector(".popup__caption"),I=document.forms,P=I["edit-profile"],M=I["new-place"],U=I["remove-card"],V=I["new-avatar"],N=function(e,t){var r=null;return function(o){t?(r=_,t=!1):(r=m,t=!0),r(e).then((function(e){n(o,e.likes.length)})).catch(console.error)}},z=function(e){var t=e.name,n=e.link;T.src=n,T.alt="изображение в модальном окне, на котором ".concat(t),D.textContent=t,a(C)},B=function(e){var t;t=e.id,U["card-id"].value=t,a(A)},G=function(e){x.textContent=e.name,j.textContent=e.about,e.avatar&&(O.style.backgroundImage="url(".concat(e.avatar,")"))};k.addEventListener("click",(function(){a(L),h(L,M)})),q.addEventListener("click",(function(){P.name.value=x.textContent,P.description.value=j.textContent,a(E),h(E,P)})),O.addEventListener("click",(function(e){a(w),h(w,V)})),M.addEventListener("submit",(function(t){var n;t.preventDefault(),(n={name:t.target["place-name"].value,link:t.target.link.value},f({url:"/cards",method:"POST",body:n}).then(p)).then((function(t){var n=e(S,t,B,N(t._id,!1),z);g.prepend(n),c(L)})).catch(console.error)})),P.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:e.target.name.value,about:e.target.description.value},f({url:"/users/me",method:i,body:t}).then(p)).then((function(e){G(e),c(E)})).catch(console.error)})),U.addEventListener("submit",(function(e){e.preventDefault();var t=e.target["card-id"].value;(function(e){return f({url:l(e),method:u}).then(p)})(t).then((function(e){document.querySelector('[data-card-id="'.concat(t,'"]')).remove(),c(A)})).catch(console.error)})),V.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={avatar:e.target["avatar-link"].value},f({url:"".concat("/users/me","/avatar"),method:i,body:t}).then(p)).then((function(e){G(e),c(w)})).catch(console.error)})),Promise.all([f({url:"/users/me"}).then(p),f({url:"/cards"}).then(p)]).then((function(r){var o,c,a=(c=2,function(e){if(Array.isArray(e))return e}(o=r)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(o,c)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(o,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];G(i),function(r,o){r.forEach((function(r){var c=r.likes.find((function(e){return e._id===o._id})),a=e(S,r,B,N(r._id,c),z);!function(e,r){var o=e.querySelector(".card__delete-button"),c=e.querySelector(".card__like-button");r.isOwner||o.remove(),r.isLiked&&n({target:c}),r.likesCount&&t(e,r.likesCount)}(a,{isLiked:c,isOwner:r.owner._id===o._id,likesCount:r.likes.length}),g.append(a)}))}(u,i)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");y(t,n),t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?v(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add("form__input_type_error"),r.textContent=n,r.classList.add("form__input-error_active")}(e,t,t.validationMessage)}(e,r),y(t,n)}))}))}(e)}))})();